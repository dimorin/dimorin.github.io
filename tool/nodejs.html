<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js | DIMORIN BLOG</title>
    <meta name="description" content="study study">
    
    
    <link rel="preload" href="/assets/css/0.styles.93a325d7.css" as="style"><link rel="preload" href="/assets/js/app.77835d9f.js" as="script"><link rel="preload" href="/assets/js/57.6856783c.js" as="script"><link rel="prefetch" href="/assets/js/10.92d3e5b8.js"><link rel="prefetch" href="/assets/js/11.55256d47.js"><link rel="prefetch" href="/assets/js/12.701e2a2e.js"><link rel="prefetch" href="/assets/js/13.c63432d7.js"><link rel="prefetch" href="/assets/js/14.a022bc26.js"><link rel="prefetch" href="/assets/js/15.b0fa8f2e.js"><link rel="prefetch" href="/assets/js/16.6c35d725.js"><link rel="prefetch" href="/assets/js/17.d23da85c.js"><link rel="prefetch" href="/assets/js/18.8bd56e3e.js"><link rel="prefetch" href="/assets/js/19.374063a5.js"><link rel="prefetch" href="/assets/js/2.7974f97d.js"><link rel="prefetch" href="/assets/js/20.8ffbe681.js"><link rel="prefetch" href="/assets/js/21.2a0b842a.js"><link rel="prefetch" href="/assets/js/22.7b06e95c.js"><link rel="prefetch" href="/assets/js/23.90dd531d.js"><link rel="prefetch" href="/assets/js/24.78462168.js"><link rel="prefetch" href="/assets/js/25.32dd44c7.js"><link rel="prefetch" href="/assets/js/26.91d3e8cd.js"><link rel="prefetch" href="/assets/js/27.47150ce0.js"><link rel="prefetch" href="/assets/js/28.176815f3.js"><link rel="prefetch" href="/assets/js/29.ba182c0c.js"><link rel="prefetch" href="/assets/js/3.bfaaf056.js"><link rel="prefetch" href="/assets/js/30.d300a1ad.js"><link rel="prefetch" href="/assets/js/31.9ab89447.js"><link rel="prefetch" href="/assets/js/32.07c5a001.js"><link rel="prefetch" href="/assets/js/33.94bd0b45.js"><link rel="prefetch" href="/assets/js/34.86389809.js"><link rel="prefetch" href="/assets/js/35.c1c6820c.js"><link rel="prefetch" href="/assets/js/36.d5e438b4.js"><link rel="prefetch" href="/assets/js/37.84cdff88.js"><link rel="prefetch" href="/assets/js/38.329f6167.js"><link rel="prefetch" href="/assets/js/39.2e4eae59.js"><link rel="prefetch" href="/assets/js/4.c0a93a24.js"><link rel="prefetch" href="/assets/js/40.ff08dc93.js"><link rel="prefetch" href="/assets/js/41.a223caec.js"><link rel="prefetch" href="/assets/js/42.12c9833c.js"><link rel="prefetch" href="/assets/js/43.954cd681.js"><link rel="prefetch" href="/assets/js/44.10fd9051.js"><link rel="prefetch" href="/assets/js/45.a04602d1.js"><link rel="prefetch" href="/assets/js/46.3515d73d.js"><link rel="prefetch" href="/assets/js/47.331fe9b8.js"><link rel="prefetch" href="/assets/js/48.87cb2e9d.js"><link rel="prefetch" href="/assets/js/49.d539cc74.js"><link rel="prefetch" href="/assets/js/5.9a667794.js"><link rel="prefetch" href="/assets/js/50.b43f76a9.js"><link rel="prefetch" href="/assets/js/51.cc05557f.js"><link rel="prefetch" href="/assets/js/52.562f0b3e.js"><link rel="prefetch" href="/assets/js/53.0627a582.js"><link rel="prefetch" href="/assets/js/54.e0cd453c.js"><link rel="prefetch" href="/assets/js/55.17953b13.js"><link rel="prefetch" href="/assets/js/56.948649da.js"><link rel="prefetch" href="/assets/js/58.e4446aa9.js"><link rel="prefetch" href="/assets/js/59.70b35561.js"><link rel="prefetch" href="/assets/js/6.5871f1c8.js"><link rel="prefetch" href="/assets/js/60.5448b63f.js"><link rel="prefetch" href="/assets/js/61.63dec433.js"><link rel="prefetch" href="/assets/js/62.df4cd1d4.js"><link rel="prefetch" href="/assets/js/63.1826584e.js"><link rel="prefetch" href="/assets/js/64.0bfd909b.js"><link rel="prefetch" href="/assets/js/65.07d886c7.js"><link rel="prefetch" href="/assets/js/66.8359585d.js"><link rel="prefetch" href="/assets/js/67.9dd06aef.js"><link rel="prefetch" href="/assets/js/68.07c77763.js"><link rel="prefetch" href="/assets/js/69.d51f658a.js"><link rel="prefetch" href="/assets/js/7.312a3680.js"><link rel="prefetch" href="/assets/js/8.fca20ce1.js"><link rel="prefetch" href="/assets/js/9.449ccc19.js">
    <link rel="stylesheet" href="/assets/css/0.styles.93a325d7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DIMORIN BLOG</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">HOME</a></div><div class="nav-item"><a href="/js/" class="nav-link">JS</a></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/staticsite/" class="nav-link">Static Site</a></div><div class="nav-item"><a href="/pwa/" class="nav-link">PWA</a></div><div class="nav-item"><a href="/tool/" class="nav-link router-link-active">프론트엔드개발툴</a></div><div class="nav-item"><a href="/python/" class="nav-link">Python</a></div><div class="nav-item"><a href="/webgl/" class="nav-link">WebGL</a></div><div class="nav-item"><a href="/dv/" class="nav-link">데이터시각화</a></div><div class="nav-item"><a href="/about.html" class="nav-link">ABOUT</a></div><div class="nav-item"><a href="/deskg.html" class="nav-link">DESK.G</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">HOME</a></div><div class="nav-item"><a href="/js/" class="nav-link">JS</a></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/staticsite/" class="nav-link">Static Site</a></div><div class="nav-item"><a href="/pwa/" class="nav-link">PWA</a></div><div class="nav-item"><a href="/tool/" class="nav-link router-link-active">프론트엔드개발툴</a></div><div class="nav-item"><a href="/python/" class="nav-link">Python</a></div><div class="nav-item"><a href="/webgl/" class="nav-link">WebGL</a></div><div class="nav-item"><a href="/dv/" class="nav-link">데이터시각화</a></div><div class="nav-item"><a href="/about.html" class="nav-link">ABOUT</a></div><div class="nav-item"><a href="/deskg.html" class="nav-link">DESK.G</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/tool/" class="sidebar-link">프론트엔드 환경 구축</a></li><li><a href="/tool/designpattern.html" class="sidebar-link">디자인 패턴</a></li><li><a href="/tool/npm.html" class="sidebar-link">npm</a></li><li><a href="/tool/sass.html" class="sidebar-link">SASS</a></li><li><a href="/tool/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/tool/firebase.html" class="sidebar-link">Firebase</a></li><li><a href="/tool/git.html" class="sidebar-link">git</a></li><li><a href="/tool/nodejs.html" class="active sidebar-link">Node.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tool/nodejs.html#node-js-basics" class="sidebar-link">Node.js Basics</a></li><li class="sidebar-sub-header"><a href="/tool/nodejs.html#node-js-npm" class="sidebar-link">Node.js &amp; npm</a></li><li class="sidebar-sub-header"><a href="/tool/nodejs.html#node-js-module" class="sidebar-link">Node.js module</a></li><li class="sidebar-sub-header"><a href="/tool/nodejs.html#node-js-file-upload-example" class="sidebar-link">Node.js file upload example</a></li></ul></li><li><a href="/tool/express.html" class="sidebar-link">Express</a></li><li><a href="/tool/gulp.html" class="sidebar-link">gulp</a></li><li><a href="/tool/eventloop.html" class="sidebar-link">event loop</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="node-js"><a href="#node-js" aria-hidden="true" class="header-anchor">#</a> Node.js</h1> <p>네트워크 애플리케이션을 위한 자바스크립트 런타임 환경</p> <h2 id="node-js-basics"><a href="#node-js-basics" aria-hidden="true" class="header-anchor">#</a> Node.js Basics</h2> <h3 id="introduction"><a href="#introduction" aria-hidden="true" class="header-anchor">#</a> introduction</h3> <ul><li>Node.js는 Chrome V8 자바스크립트 엔진으로 빌드된 자바스크립트 런타임 환경(Runtime Environment)으로 주로 서버 사이드 애플리케이션 개발에 사용되는 소프트웨어 플랫폼이다.</li> <li>Node.js는 브라우저 외부 환경에서 자바스크립트 애플리케이션 개발에 사용되며 이에 필요한 모듈, 파일 시스템, HTTP 등 Built-in API를 제공한다.</li> <li>Node.js는 자바스크립트를 사용해 개발한다. Front-end와 Back-end에서 자바스크립트를 사용할 수 있다는 동형성(isomorphic)은 별도의 언어 학습 시간을 단축해 주는 장점이 있다.</li> <li>Node.js는 Non-blocking I/O와 단일 스레드 이벤트 루프를 통한 높은 Request 처리 성능을 가지고 있다.
<ul><li>데이터베이스로부터 대량의 데이터를 취득하여 웹페이지에 표시할 때, 일반적으로 데이터베이스 처리에 대기시간(blocking)이 발생하기 때문에 웹페이지 표시가 지연되는 현상이 발생한다. Node.js의 모든 API는 비동기 방식으로 동작하여 Non-blocking I/O가 가능하고 단일 스레드 이벤트 루프 모델을 사용하여 보다 가벼운 환경에서도 높은 Request 처리 성능을 가지고 있다.</li> <li>Node.js는 데이터를 실시간 처리하여 빈번한 I/O가 발생하는 SPA(Single Page Application)에 적합하다. 하지만 CPU 사용률이 높은 애플리케이션에는 권장하지 않는다.</li> <li>Node.js에는 Socket.io라는 실시간 통신을 실현하는 라이브러리를 사용할 수 있어서 대량의 데이터 처리와 실시간 통신을 구현할 수 기능을 모두 갖추고 있다.</li></ul></li></ul> <h3 id="install"><a href="#install" aria-hidden="true" class="header-anchor">#</a> install</h3> <p><a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Node.js의 웹사이트<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><code>npm</code>도 동시에 설치된다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ node -v
$ <span class="token function">npm</span> -v
$ <span class="token function">npm</span> <span class="token function">install</span> -g npm@latest
$ <span class="token function">npm</span> -v
</code></pre></div><h3 id="repl"><a href="#repl" aria-hidden="true" class="header-anchor">#</a> REPL</h3> <p>REPL(Read Eval Print Loop: 입력 수행 출력 반복)은 Node.js는 물론 대부분의 언어(Java, Python 등)가 제공하는 가상환경으로 간단한 코드를 직접 실행해 결과를 확인해 볼 수 있다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ node
<span class="token operator">&gt;</span> 1 * 0
0
<span class="token operator">&gt;</span> x <span class="token operator">=</span> 10
10
<span class="token operator">&gt;</span> console.log<span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span>
Hello World
undefined
</code></pre></div><h3 id="http-server"><a href="#http-server" aria-hidden="true" class="header-anchor">#</a> HTTP Server</h3> <p>Node.js를 사용하여 간단한 HTTP 서버를 작성해 보자.
Node.js는 http 서버 모듈을 내장하고 있어서 아파치와 같은 별도의 웹서버를 설치할 필요가 없다.
아래와 같은 내용으로 app.js 파일을 생성한다.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* app.js */</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 2</span>
  response<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:3000/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li>http 모듈을 로딩하여 변수 http에 할당하였다.</li> <li>http 모듈의 createServer([requestListener]) 메소드를 사용하여 HTTP 서버 객체를 생성한다. HTTP 서버 객체는 EventEmitter 클래스를 상속한 것으로 request 이벤트가 발생하면 HTTP request를 처리하여 response를 반환하는 request Listener 함수를 호출한다. 이 request Listener 함수는 request와 response 객체를 전달받으며 HTTP request 이벤트가 발생할 때마다 한번씩 호출된다.</li> <li>createServer 메소드가 반환한 HTTP 서버 객체의 listen 메소드에 포트번호 3000을 전달하여 서버를 실행한다.</li> <li>app.js 파일이 있는 경로에서 다음 명령으로 서버를 실행한다.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ node app.js
</code></pre></div><ol start="5"><li>위 명령을 실행하고 브라우저에서 “http://localhost:3000” 에 접속하면 “Hello World”가 출력되는 것을 확인할 수 있다.</li></ol> <h3 id="모듈화와-commonjs"><a href="#모듈화와-commonjs" aria-hidden="true" class="header-anchor">#</a> 모듈화와 CommonJS</h3> <p>브라우저에서의 모듈 사용은 대부분의 브라우저가 ES6의 모듈을 지원하지 않고 있으므로 Browserify 또는 webpack과 같은 모듈 번들러를 사용하여야 한다.</p> <h2 id="node-js-npm"><a href="#node-js-npm" aria-hidden="true" class="header-anchor">#</a> Node.js &amp; npm</h2> <p>npm(node package manager)은 자바스크립트 패키지 매니저이다.
Node.js에서 사용할 수 있는 모듈들을 패키지화하여 모아둔 저장소 역할과 패키지 설치 및 관리를 위한 CLI(Command line interface)를 제공한다.
자신이 작성한 패키지를 공개할 수도 있고 필요한 패키지를 검색하여 재사용할 수도 있다.</p> <h3 id="패키지-설치"><a href="#패키지-설치" aria-hidden="true" class="header-anchor">#</a> 패키지 설치</h3> <p>Node.js에서 사용할 수 있는 모듈인 패키지를 설치할 때에는 npm install 명령어 뒤에 설치할 패키지 이름을 지정한다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span>
</code></pre></div><p>Node.js 환경에서 emoji를 지원하는 node-emoji를 설치해 보자.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> node-emoji
</code></pre></div><h3 id="지역-설치-전역-설치"><a href="#지역-설치-전역-설치" aria-hidden="true" class="header-anchor">#</a> 지역 설치 전역 설치</h3> <p>옵션을 별도로 지정하지 않으면 지역으로 설치되며, 프로젝트 루트 디렉터리에 node_modules 디렉터리가 자동 생성되고 그 안에 패키지가 설치된다.
지역으로 설치된 패키지는 해당 프로젝트 내에서만 사용할 수 있다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 전역 설치</span>
$ <span class="token function">npm</span> <span class="token function">install</span> -g <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span>
</code></pre></div><h4 id="전역에-설치된-패키지는-os에-따라-설치-장소가-다르다"><a href="#전역에-설치된-패키지는-os에-따라-설치-장소가-다르다" aria-hidden="true" class="header-anchor">#</a> 전역에 설치된 패키지는 OS에 따라 설치 장소가 다르다.</h4> <ul><li>macOS의 경우
/usr/local/lib/node_modules</li> <li>윈도우의 경우
c:\Users%USERNAME%\AppData\Roaming\npm\node_modules</li></ul> <p>node 명령어로 Node.js REPL을 실행하고 node-emoji를 로드한 후 emoji를 출력해 보자.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ node
<span class="token operator">&gt;</span> var emoji <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'node-emoji'</span><span class="token punctuation">)</span>.emoji<span class="token punctuation">;</span>
undefined
<span class="token operator">&gt;</span> console.log<span class="token punctuation">(</span>emoji.heart<span class="token punctuation">)</span><span class="token punctuation">;</span>
❤️
undefined
</code></pre></div><h3 id="package-json-과-의존성-관리"><a href="#package-json-과-의존성-관리" aria-hidden="true" class="header-anchor">#</a> package.json 과 의존성 관리</h3> <p>Node.js 프로젝트에서는 많은 패키지를 사용하게 되고 패키지의 버전도 빈번하게 업데이트되므로 프로젝트가 의존하고 있는 패키지를 일괄 관리할 필요가 있다.
npm은 package.json 파일을 통해서 프로젝트 정보와 패키지의 의존성(dependency)을 관리한다.
이미 작성된 package.json이 있다면 팀 내에 배포하여 동일한 개발 환경을 빠르게 구축할 수 있는 장점이 있다.
package.json은 Java의 maven에서 pom.xml과 비슷한 역할을 한다.
package.json을 생성하려면 프로젝트 루트에서 <code>npm init</code> 명령어를 실행한다.
npm init 명령어에 <code>--yes</code> 또는 <code>-y</code> 옵션을 추가한다. 그러면 기본 설정값으로 package.json 파일을 생성한다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> init -y
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code>/* package.json */
<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;node-emoji&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.8.1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>package.json에서 가장 중요한 항목은 <code>name</code>과 <code>version</code>이다. 이것으로 패키지의 고유성을 판단하므로 생략할 수 없다.
그리고 <code>dependencies</code> 항목에는 해당 프로젝트가 의존하는 패키지들의 이름과 버전을 명시한다.
여기서 의존하는 패키지란 해당 프로젝트에서 참조하는 모듈을 의미한다.
프로젝트를 진행할 때는 이미 만들어진 여러 패키지를 참조해서 사용하는데, package.json 파일의 dependencies 항목에 해당 패키지의 이름과 버전을 명시함으로써 의존성을 설정한다.
npm install 명령어에 <code>--save</code> 옵션을 사용하면 패키지 설치와 함께 package.json의 dependencies에 설치된 패키지 이름과 버전이 기록된다.</p> <p>npm install 명령어에 --save 옵션을 사용하면 패키지 설치와 함께 package.json의 dependencies에 설치된 패키지 이름과 버전이 기록된다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> node-emoji --save
</code></pre></div><p>npm@5부터 <code>--save</code>는 기본 옵션이 되었다.
<code>--save</code> 옵션을 사용하지 않더라도 모든 install 명령은 package.json의 dependencies에 설치된 패키지와 버전을 기록한다.
기존의 <code>--save-dev</code>은 변경되지 않았다.
<code>devDependencies</code>에는 개발 시에만 사용하는 개발용 의존 패키지를 명시한다.
예를 들어 TypeScript와 같은 트랜스파일러는 개발 단계에서만 필요하고 배포할 필요는 없으므로 devDependencies에 포함시킨다.
npm install 명령어에 <code>--save-dev</code>(축약형 -D) 옵션을 사용하면 패키지 설치와 함께 package.json의 devDependencies에 설치된 패키지와 버전이 기록된다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span> --save-dev
</code></pre></div><p>npm install 명령어를 사용하면 package.json에 명시된 모든 의존 패키지를 한번에 설치할 수 있다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div><p><a href="https://docs.npmjs.com/files/package.json" target="_blank" rel="noopener noreferrer">package.json<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="semantic-versioning-유의적-버전"><a href="#semantic-versioning-유의적-버전" aria-hidden="true" class="header-anchor">#</a> Semantic versioning(유의적 버전)</h3> <p>npm install 명령어의 패키명 뒤에 @버전을 추가하면 패키지 버전을 지정하여 설치할 수 있다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> node-emoji@1.5.0
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code>...
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;node-emoji&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.5.1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
...
</code></pre></div><p>이때 package.json의 <code>dependencies</code>에 새롭게 추가한 패키지가 추가되고 버전 앞에 <code>^</code>(캐럿)이 추가된 것을 확인할 수 있다.
이것은 패키지 버전을 지정하였을 때 뿐만이 아니라 <code>--save-exact</code> 옵션을 지정하지 않으면 기본적으로 추가되는 것이다.
이 <code>^</code>(캐럿)은 이후 해당 패키지의 버전이 업데이트되었을 경우, 마이너 버전 범위 내에서 업데이트를 허용한다는 의미이다.
npm install 명령어에 <code>--save-exact</code> 옵션을 지정하면 설치된 버전을 범위 지정없이 기록한다.
npm은 semantic versioning(유의적 버전)을 지원한다.
버전 정보는 메이저 버전 번호, 마이너 버전 번호, 패치 버전 번호로 구성된다.</p> <h3 id="자주-사용하는-npm-명령어"><a href="#자주-사용하는-npm-명령어" aria-hidden="true" class="header-anchor">#</a> 자주 사용하는 npm 명령어</h3> <ul><li>package.json 생성<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> init
<span class="token comment"># 기본 설정</span>
$ <span class="token function">npm</span> init -y
</code></pre></div></li> <li>패키지 설치<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 로컬 설치</span>
$ <span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package-name<span class="token operator">&gt;</span>
<span class="token comment"># 전역 설치</span>
$ <span class="token function">npm</span> <span class="token function">install</span> -g <span class="token operator">&lt;</span>package-name<span class="token operator">&gt;</span>
<span class="token comment"># 개발 설치</span>
$ <span class="token function">npm</span> <span class="token function">install</span> --save-dev <span class="token operator">&lt;</span>package-name<span class="token operator">&gt;</span>
<span class="token comment"># package.json의 모든 패키지 설치</span>
$ <span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div></li> <li>패키지 제거<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 로컬/개발 패키지 제거</span>
$ <span class="token function">npm</span> uninstall <span class="token operator">&lt;</span>package-name<span class="token operator">&gt;</span>
<span class="token comment"># 전역 패키지 제거</span>
$ <span class="token function">npm</span> uninstall -g <span class="token operator">&lt;</span>package-name<span class="token operator">&gt;</span>
</code></pre></div></li> <li>패키지 업데이트<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> update <span class="token operator">&lt;</span>package-name<span class="token operator">&gt;</span>
</code></pre></div></li> <li>전역 설치 패키지 확인<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">ls</span> -g --depth<span class="token operator">=</span>0
</code></pre></div></li> <li>package.json scripts 프로퍼티의 start 실행<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> start
</code></pre></div></li> <li>package.json scripts 프로퍼티의 start 이외의 scripts 실행<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> run <span class="token operator">&lt;</span>script-name<span class="token operator">&gt;</span>
</code></pre></div></li> <li>전역 패키지 설치 폴더 확인<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> root -g
/usr/local/lib/node_modules
<span class="token comment"># 파인더 오픈</span>
$ <span class="token function">open</span> /usr/local/lib/node_modules
</code></pre></div></li> <li>패티지 정보 참조<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> view <span class="token operator">&lt;</span>package-name<span class="token operator">&gt;</span>
<span class="token comment"># 함께 설치해야 하는 다른 패키지 확인</span>
$ <span class="token function">npm</span> view <span class="token operator">&lt;</span>package-name<span class="token operator">&gt;</span> peerDependencies
</code></pre></div></li> <li>버전 확인<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> -v
</code></pre></div></li> <li>npm 명령어 설명 참조<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">help</span> <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span>
</code></pre></div></li></ul> <p><a href="https://docs.npmjs.com/#cli" target="_blank" rel="noopener noreferrer">npm CLI 명령어<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="node-js-module"><a href="#node-js-module" aria-hidden="true" class="header-anchor">#</a> Node.js module</h2> <ul><li>브라우저 상에서 동작하는 JavaScript는 script tag로 로드하며 복수의 JavaScript 파일을 로드할 경우 하나의 파일로 merge되며 동일한 유효범위를 갖게 된다.</li> <li>Node.js는 module 단위로 각 기능을 분할할 수 있다. module은 파일과 1대1의 대응 관계를 가지며 하나의 모듈은 자신만의 독립적인 실행 영역(Scope)를 가지게 된다. 따라서 클라이언트 사이드 JavaScript와는 달리 전역변수의 중복 문제가 발생하지 않는다.</li> <li>모듈은 module.exports 또는 exports 객체를 통해 정의하고 외부로 공개한다. 그리고 공개된 모듈은 require 함수를 사용하여 임포트한다.</li></ul> <h3 id="exports"><a href="#exports" aria-hidden="true" class="header-anchor">#</a> exports</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// circle.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">PI</span> <span class="token punctuation">}</span> <span class="token operator">=</span> Math<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">area</span> <span class="token operator">=</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">PI</span> <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">circumference</span> <span class="token operator">=</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token constant">PI</span> <span class="token operator">*</span> r<span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// app.js</span>
<span class="token keyword">const</span> circle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./circle.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// == require('./circle')</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`지름이 4인 원의 면적: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>circle<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`지름이 4인 원의 둘레: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>circle<span class="token punctuation">.</span><span class="token function">circumference</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>$ node app
지름이 4인 원의 면적: 50.26548245743669
지름이 4인 원의 둘레: 25.132741228718345
</code></pre></div><h3 id="module-exports"><a href="#module-exports" aria-hidden="true" class="header-anchor">#</a> module.exports</h3> <p>exports 객체는 프로퍼티 또는 메소드를 여러 개 정의할 수 있었다.
하지만 module.exports에는 하나의 값(원시 타입, 함수, 객체)을 할당할 수 있다.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// circle.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">PI</span> <span class="token punctuation">}</span> <span class="token operator">=</span> Math<span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token constant">PI</span> <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">circumference</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token constant">PI</span> <span class="token operator">*</span> r<span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// app.js</span>
<span class="token keyword">const</span> circle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./circle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> myCircle <span class="token operator">=</span> <span class="token function">circle</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`지름이 4인 원의 면적: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>myCircle<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`지름이 4인 원의 둘레: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>myCircle<span class="token punctuation">.</span><span class="token function">circumference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// primitive.js</span>
<span class="token keyword">const</span> pv <span class="token operator">=</span> <span class="token string">'primitive value'</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> pv<span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// app.js</span>
<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./primitive'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'primitive value'</span>
</code></pre></div><table><thead><tr><th>구분</th> <th>모듈 정의 방식</th> <th>require 함수의 호출 결과</th></tr></thead> <tbody><tr><td>exports</td> <td>exports 객체에는 값을 할당할 수 없고 공개할 대상을 exports 객체에 프로퍼티 또는 메소드로 추가한다.</td> <td>exports 객체에 추가한 프로퍼티와 메소드가 담긴 객체가 전달된다.</td></tr> <tr><td>module.exports</td> <td>module.exports 객체에 하나의 값(원시 타입, 함수, 객체)만을 할당한다.</td> <td>module.exports 객체에 할당한 값이 전달된다.</td></tr></tbody></table> <h3 id="코어-모듈과-파일-모듈"><a href="#코어-모듈과-파일-모듈" aria-hidden="true" class="header-anchor">#</a> 코어 모듈과 파일 모듈</h3> <p>Node.js는 기본으로 포함하고 있는 모듈이 있다. 이를 코어 모듈이라 한다. 코어 모듈을 로딩할 때에는 패스를 명시하지 않아도 무방하다.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>npm을 통해 설치한 외부 패키지 또한 패스를 명시하지 않아도 무방하다.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>코어 모듈과 외부 패키지 이외는 모두 파일 모듈이다. 파일 모듈을 로딩할 때에는 패스를 명시하여야 한다.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib/foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="node-js-file-upload-example"><a href="#node-js-file-upload-example" aria-hidden="true" class="header-anchor">#</a> Node.js file upload example</h2> <p>Node.js는 Server-side Javascript이다.
즉, 백엔드에서 자바스크립트를 실행할 수 있게 한다.
또한 유용한 모듈을 내부에 탑재하고 있고 필요에 따라 npm 등을 사용하여 외부에서 필요한 모듈을 import하여 사용할 수 있어 높은 생산성과 스피디한 개발을 가능케 해준다.
따라서 Node.js는 Server-side Javascript와 모듈(라이브러리)로 구성되어 있고 말할 수 있다.</p> <p><strong>file upload 예제</strong>를 통해서 Node.js의 기본과 Routing, 모듈화, Request Handling 등을 알아보자.</p> <h3 id="use-cases"><a href="#use-cases" aria-hidden="true" class="header-anchor">#</a> Use cases</h3> <ul><li>사용자는 웹 브라우저로 이 웹 애플리케이션을 이용할 수 있다.</li> <li>사용자가 http://domain/start 를 요청하면 파일 업로드 폼이 들어있는 웰컴 페이지를 볼 수 있어야 한다.</li> <li>업로드할 이미지 파일을 선택해서 폼으로 전송하면, 해당 이미지는 http://domain/upload 로 업로드 되어야 하며, 업로드가 끝나면 해당 페이지에 표시된다.</li></ul> <h3 id="application-stack"><a href="#application-stack" aria-hidden="true" class="header-anchor">#</a> Application Stack</h3> <ul><li>웹페이지를 제공해야 한다. 따라서 HTTP 서버가 필요하다.</li> <li>서버는 URL 요청(request)별로 다르게 응답해야 한다. 따라서, 요청과 요청을 처리할 핸들러들을 연결짓기 위한 라우터(router) 같은 것이 필요하다.</li> <li>서버로 도착한 요청들, 그리고 라우터를 이용해서 라우팅된 요청들을 만족시키기 위해서 실제적인 요청 핸들러(request handler)가 필요하다.</li> <li>라우터는 들어오는 어떠한 POST 데이터들도 다룰 수 있어야 한다. 그리고 해당 데이터를 다루기 편한 형태로 만들어 요청 핸들러(request handler) 들에게 넘겨야 한다. 따라서 요청 데이터 핸들링(request data handling)이 필요하다.</li> <li>URL에 대한 요청을 다루는 것뿐 아니라 URL이 요청되었을 때 내용을 표시할 필요도 있다. 즉, 요청 핸들러(request handler)는 사용자 브라우저로 컨텐트를 보내기 위한한 뷰 로직(view logic)이 필요하다.</li> <li>사용자가 이미지들을 업로드 할 수 있어야 하므로 세부 사항을 다루는 업로드 핸들링(upload handling)이 필요하다.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>response의 이동
sever ⇒ router ⇒ request handler
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* index.js */</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./router&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> requestHandlers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./requestHandlers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
handle<span class="token punctuation">[</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> requestHandlers<span class="token punctuation">.</span>start<span class="token punctuation">;</span>
handle<span class="token punctuation">[</span><span class="token string">&quot;/start&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> requestHandlers<span class="token punctuation">.</span>start<span class="token punctuation">;</span>
handle<span class="token punctuation">[</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> requestHandlers<span class="token punctuation">.</span>upload<span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>route<span class="token punctuation">,</span> handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* server.js */</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> handle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">onRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> postData <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Request for &quot;</span> <span class="token operator">+</span> pathname <span class="token operator">+</span> <span class="token string">&quot; received.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        request<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        request<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>postDataChunk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            postData <span class="token operator">+=</span> postDataChunk<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Received POST data chunk '&quot;</span><span class="token operator">+</span>
            postDataChunk <span class="token operator">+</span> <span class="token string">&quot;'.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">route</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> pathname<span class="token punctuation">,</span> response<span class="token punctuation">,</span> postData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>onRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server has started. try localhost:8000/user?name=kim&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* router.js */</span>
<span class="token keyword">function</span> <span class="token function">route</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> pathname<span class="token punctuation">,</span> response<span class="token punctuation">,</span> postData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;About to route a request for &quot;</span> <span class="token operator">+</span> pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> handle<span class="token punctuation">[</span>pathname<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        handle<span class="token punctuation">[</span>pathname<span class="token punctuation">]</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> postData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;No request handler found for &quot;</span> <span class="token operator">+</span> pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;404 Not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>route <span class="token operator">=</span> route<span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* requestHandlers.js */</span>
<span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> postData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;^^ Request handler 'start' was called.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token string">'&lt;html&gt;'</span><span class="token operator">+</span>
      <span class="token string">'&lt;head&gt;'</span><span class="token operator">+</span>
      <span class="token string">'&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; '</span><span class="token operator">+</span>
      <span class="token string">'charset=UTF-8&quot; /&gt;'</span><span class="token operator">+</span>
      <span class="token string">'&lt;/head&gt;'</span><span class="token operator">+</span>
      <span class="token string">'&lt;body&gt;'</span><span class="token operator">+</span>
      <span class="token string">'&lt;form action=&quot;/upload&quot; method=&quot;post&quot;&gt;'</span><span class="token operator">+</span>
      <span class="token string">'&lt;textarea name=&quot;text&quot; rows=&quot;20&quot; cols=&quot;60&quot;&gt;&lt;/textarea&gt;'</span><span class="token operator">+</span>
      <span class="token string">'&lt;input type=&quot;submit&quot; value=&quot;Submit text&quot; /&gt;'</span><span class="token operator">+</span>
      <span class="token string">'&lt;/form&gt;'</span><span class="token operator">+</span>
      <span class="token string">'&lt;/body&gt;'</span><span class="token operator">+</span>
      <span class="token string">'&lt;/html&gt;'</span><span class="token punctuation">;</span>
  
    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> postData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Request handler 'upload' was called.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;You've sent: &quot;</span> <span class="token operator">+</span> postData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>upload <span class="token operator">=</span> upload<span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>node index.js
</code></pre></div><p><code>url</code>모듈을 사용하여 URL path를 기준으로 요청을 구분할 수 있게 되었다. 이것을 이용하면 URL path를 기반으로 요청을 request handler로 매핑하는 router를 만들 수 있다.
router의 역할은 클라이언트의 요청과 request handler를 매핑하는 것이다.</p> <p>예를 들어, /start 요청과 /upload 요청에 각각 달리 반응하는 request handler를 매핑할 수 있다. 우선은 URL path를 전달받는 router를 구현한다.</p> <p>http://localhost:8888/start 를 요청하면 “Hello Start”가 출력되고,
http://localhost:8888/upload 는 “Hello Upload”가,
http://localhost:8888/foo 는 “404 Not found”가 출력된다.</p> <p>기존의 웹 서버는 대부분 쓰레드를 기반으로 하는 동기 방식으로 I/O를 처리를 한다.
반면에 Node.js는 이벤트를 기반으로 하는 비동기 방식으로 I/O를 처리한다.
Node.js의 방식을 이벤트 기반 비동기 방식 이라 한다.</p> <h4 id="handling-file-uploads"><a href="#handling-file-uploads" aria-hidden="true" class="header-anchor">#</a> Handling file uploads</h4> <p>사용자가 이미지 파일을 업로드 하면 업로드된 이미지를 브라우저에 출력해보자.
파일 데이터를 받아서 처리하는 것은 단지 POST 데이터를 처리하는 것이지만,
그 처리가 단순하지 않고 복잡하기 때문에,
여기서는 미리 만들어진 formidable 오픈소스 모듈을 사용한다.</p> <p><code>formidable</code>은 HTTP POST로 submit 된 “form”을 Node.js에서 파싱할 수 있게 (“parseable”) 한다. 사용법은 다음과 같다.</p> <ol><li>새 IncomingForm을 생성한다. 이것은 submit된 form의 추상화 객체이다.</li> <li>request 객체를 파싱하여 submit된 파일과 필드들을 얻는다.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> init
$ <span class="token function">npm</span> <span class="token function">install</span> formidable --save
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code>/* package.json */
<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;formidable&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.2.1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>formidable</code>을 사용하여 할 일은 2가지다.</p> <ol><li>업로드된 파일을 저장 (/tmp 폴더)</li> <li>업로드된 파일을 읽어 들여 화면에 출력</li></ol> <p>/tmp/test.png에 파일이 존재한다고 가정하고 <code>/show request handler</code>에서 이것을 처리한다고 하자.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* index.js */</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./router&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> requestHandlers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./requestHandlers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> handle <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
handle<span class="token punctuation">[</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> requestHandlers<span class="token punctuation">.</span>start<span class="token punctuation">;</span>
handle<span class="token punctuation">[</span><span class="token string">&quot;/start&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> requestHandlers<span class="token punctuation">.</span>start<span class="token punctuation">;</span>
handle<span class="token punctuation">[</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> requestHandlers<span class="token punctuation">.</span>upload<span class="token punctuation">;</span>
handle<span class="token punctuation">[</span><span class="token string">&quot;/show&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> requestHandlers<span class="token punctuation">.</span>show<span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>route<span class="token punctuation">,</span> handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* server.js */</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> handle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">onRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Request for &quot;</span> <span class="token operator">+</span> pathname <span class="token operator">+</span> <span class="token string">&quot; received.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">route</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> pathname<span class="token punctuation">,</span> response<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>onRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server has started.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* router.js */</span>
<span class="token keyword">function</span> <span class="token function">route</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> pathname<span class="token punctuation">,</span> response<span class="token punctuation">,</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;About to route a request for &quot;</span> <span class="token operator">+</span> pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> handle<span class="token punctuation">[</span>pathname<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      handle<span class="token punctuation">[</span>pathname<span class="token punctuation">]</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;No request handler found for &quot;</span> <span class="token operator">+</span> pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;404 Not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>route <span class="token operator">=</span> route<span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/* requestHandlers.js */</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    formidable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;formidable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Request handler 'start' was called.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token string">'&lt;html&gt;'</span><span class="token operator">+</span>
    <span class="token string">'&lt;head&gt;'</span><span class="token operator">+</span>
    <span class="token string">'&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; '</span><span class="token operator">+</span>
    <span class="token string">'charset=UTF-8&quot; /&gt;'</span><span class="token operator">+</span>
    <span class="token string">'&lt;/head&gt;'</span><span class="token operator">+</span>
    <span class="token string">'&lt;body&gt;'</span><span class="token operator">+</span>
    <span class="token string">'&lt;form action=&quot;/upload&quot; enctype=&quot;multipart/form-data&quot; '</span><span class="token operator">+</span>
    <span class="token string">'method=&quot;post&quot;&gt;'</span><span class="token operator">+</span>
    <span class="token string">'&lt;input type=&quot;file&quot; name=&quot;upload&quot; multiple=&quot;multiple&quot;&gt;'</span><span class="token operator">+</span>
    <span class="token string">'&lt;input type=&quot;submit&quot; value=&quot;Upload file&quot; /&gt;'</span><span class="token operator">+</span>
    <span class="token string">'&lt;/form&gt;'</span><span class="token operator">+</span>
    <span class="token string">'&lt;/body&gt;'</span><span class="token operator">+</span>
    <span class="token string">'&lt;/html&gt;'</span><span class="token punctuation">;</span>

    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Request handler 'upload' was called.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> form <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">formidable<span class="token punctuation">.</span>IncomingForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;about to parse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  form<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;parsing done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">renameSync</span><span class="token punctuation">(</span>files<span class="token punctuation">.</span>upload<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string">&quot;tmp/test.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;received image:&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;img src='/show' /&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Request handler 'show' was called.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;tmp/test.png&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;binary&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>error <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;image/png&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&quot;binary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>upload <span class="token operator">=</span> upload<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>show <span class="token operator">=</span> show<span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>node index.js
</code></pre></div><p>http://localhost:8888/show 에서 확인</p> <h3 id="참고자료"><a href="#참고자료" aria-hidden="true" class="header-anchor">#</a> 참고자료</h3> <ul><li><a href="https://poiemaweb.com/nodejs-basics" target="_blank" rel="noopener noreferrer">poiemaweb nodejs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Node.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://nodejs.org/dist/latest-v11.x/docs/api/repl.html" target="_blank" rel="noopener noreferrer">Node.js Documentation : REPL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.commonjs.org/" target="_blank" rel="noopener noreferrer">CommonJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">npm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.npmjs.com/files/package.json" target="_blank" rel="noopener noreferrer">package.json<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.npmjs.com/#cli" target="_blank" rel="noopener noreferrer">npm CLI 명령어<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://nodejs.github.io/nodejs-ko/articles/2016/06/09/es-modules-and-node-js-hard-choices/" target="_blank" rel="noopener noreferrer">ES Modules와 Node.js: 쉽지 않은 선택<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://nodejs.org/dist/latest-v8.x/docs/api/modules.html" target="_blank" rel="noopener noreferrer">Node.js v6.11.5 : Modules<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://poiemaweb.com/es6-module" target="_blank" rel="noopener noreferrer">ES6 Module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.nextree.co.kr/p7292/" target="_blank" rel="noopener noreferrer">이벤트 기반 비동기 방식<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.ibm.com/blogs/bluemix/2014/10/keeping-secrets-cloud-application-access-credentials-private-data/" target="_blank" rel="noopener noreferrer">Keeping secrets<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/tool/git.html" class="prev">
          git
        </a></span> <span class="next"><a href="/tool/express.html">
          Express
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.77835d9f.js" defer></script><script src="/assets/js/57.6856783c.js" defer></script>
  </body>
</html>
