<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Service Worker | DIMORIN BLOG</title>
    <meta name="description" content="study study">
    
    
    <link rel="preload" href="/assets/css/0.styles.b83b3449.css" as="style"><link rel="preload" href="/assets/js/app.0bfa8fde.js" as="script"><link rel="preload" href="/assets/js/25.3513309d.js" as="script"><link rel="prefetch" href="/assets/js/10.101abb43.js"><link rel="prefetch" href="/assets/js/11.2704878c.js"><link rel="prefetch" href="/assets/js/12.7b80c286.js"><link rel="prefetch" href="/assets/js/13.cba17a46.js"><link rel="prefetch" href="/assets/js/14.6919ed0f.js"><link rel="prefetch" href="/assets/js/15.be3450c7.js"><link rel="prefetch" href="/assets/js/16.bda17a54.js"><link rel="prefetch" href="/assets/js/17.bc0018e4.js"><link rel="prefetch" href="/assets/js/18.0653343c.js"><link rel="prefetch" href="/assets/js/19.107153fa.js"><link rel="prefetch" href="/assets/js/2.3c6d64e0.js"><link rel="prefetch" href="/assets/js/20.38ba6a8c.js"><link rel="prefetch" href="/assets/js/21.420b611f.js"><link rel="prefetch" href="/assets/js/22.ea1fba4e.js"><link rel="prefetch" href="/assets/js/23.a9de27c1.js"><link rel="prefetch" href="/assets/js/24.299c3787.js"><link rel="prefetch" href="/assets/js/26.c37f7b22.js"><link rel="prefetch" href="/assets/js/27.ec6b49ad.js"><link rel="prefetch" href="/assets/js/28.7fd82521.js"><link rel="prefetch" href="/assets/js/29.7ef68315.js"><link rel="prefetch" href="/assets/js/3.634b1166.js"><link rel="prefetch" href="/assets/js/30.5a781798.js"><link rel="prefetch" href="/assets/js/31.ebf90453.js"><link rel="prefetch" href="/assets/js/32.3a510981.js"><link rel="prefetch" href="/assets/js/33.0f2ba14e.js"><link rel="prefetch" href="/assets/js/34.de9c3050.js"><link rel="prefetch" href="/assets/js/35.ebe12be9.js"><link rel="prefetch" href="/assets/js/36.6d13ca26.js"><link rel="prefetch" href="/assets/js/37.2b0320a4.js"><link rel="prefetch" href="/assets/js/38.c8194c1b.js"><link rel="prefetch" href="/assets/js/39.aca4edf4.js"><link rel="prefetch" href="/assets/js/4.238ecb51.js"><link rel="prefetch" href="/assets/js/40.0a455b3d.js"><link rel="prefetch" href="/assets/js/41.2dfb0ef9.js"><link rel="prefetch" href="/assets/js/42.149ab670.js"><link rel="prefetch" href="/assets/js/43.02c8acc4.js"><link rel="prefetch" href="/assets/js/44.14a3464a.js"><link rel="prefetch" href="/assets/js/45.14d42f2a.js"><link rel="prefetch" href="/assets/js/46.1a28d578.js"><link rel="prefetch" href="/assets/js/47.09c086e0.js"><link rel="prefetch" href="/assets/js/48.0be0dc78.js"><link rel="prefetch" href="/assets/js/5.e9e75cc7.js"><link rel="prefetch" href="/assets/js/6.9faf1842.js"><link rel="prefetch" href="/assets/js/7.1cfcddcc.js"><link rel="prefetch" href="/assets/js/8.d9e6001c.js"><link rel="prefetch" href="/assets/js/9.ac62eb45.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b83b3449.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DIMORIN BLOG</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">HOME</a></div><div class="nav-item"><a href="/es6/" class="nav-link">ES6</a></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/staticsite/" class="nav-link">Static Site</a></div><div class="nav-item"><a href="/pwa/" class="nav-link router-link-active">PWA</a></div><div class="nav-item"><a href="/tool/" class="nav-link">프론트엔드개발툴</a></div><div class="nav-item"><a href="/python/" class="nav-link">Python</a></div><div class="nav-item"><a href="/webgl/" class="nav-link">WebGL</a></div><div class="nav-item"><a href="/dv/" class="nav-link">데이터시각화</a></div><div class="nav-item"><a href="/about.html" class="nav-link">ABOUT</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">HOME</a></div><div class="nav-item"><a href="/es6/" class="nav-link">ES6</a></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/staticsite/" class="nav-link">Static Site</a></div><div class="nav-item"><a href="/pwa/" class="nav-link router-link-active">PWA</a></div><div class="nav-item"><a href="/tool/" class="nav-link">프론트엔드개발툴</a></div><div class="nav-item"><a href="/python/" class="nav-link">Python</a></div><div class="nav-item"><a href="/webgl/" class="nav-link">WebGL</a></div><div class="nav-item"><a href="/dv/" class="nav-link">데이터시각화</a></div><div class="nav-item"><a href="/about.html" class="nav-link">ABOUT</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pwa/" class="sidebar-link">PWA</a></li><li><a href="/pwa/manifest.html" class="sidebar-link">Web App Manifest</a></li><li><a href="/pwa/serviceworker.html" class="active sidebar-link">Service Worker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pwa/serviceworker.html#소개" class="sidebar-link">소개</a></li><li class="sidebar-sub-header"><a href="/pwa/serviceworker.html#자바스크립트와의-차이점" class="sidebar-link">자바스크립트와의  차이점</a></li><li class="sidebar-sub-header"><a href="/pwa/serviceworker.html#특징" class="sidebar-link">특징</a></li><li class="sidebar-sub-header"><a href="/pwa/serviceworker.html#배경" class="sidebar-link">배경</a></li><li class="sidebar-sub-header"><a href="/pwa/serviceworker.html#라이프-싸이클" class="sidebar-link">라이프 싸이클</a></li><li class="sidebar-sub-header"><a href="/pwa/serviceworker.html#등록" class="sidebar-link">등록</a></li><li class="sidebar-sub-header"><a href="/pwa/serviceworker.html#설치" class="sidebar-link">설치</a></li><li class="sidebar-sub-header"><a href="/pwa/serviceworker.html#네트워크-요청-응답" class="sidebar-link">네트워크 요청 응답</a></li><li class="sidebar-sub-header"><a href="/pwa/serviceworker.html#활성화-및-업데이트" class="sidebar-link">활성화 및 업데이트</a></li></ul></li><li><a href="/pwa/library.html" class="sidebar-link">PWA 보조 라이브러리</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="service-worker"><a href="#service-worker" aria-hidden="true" class="header-anchor">#</a> Service Worker</h1> <p>Caching, Offline, Native Reatures</p> <h2 id="소개"><a href="#소개" aria-hidden="true" class="header-anchor">#</a> 소개</h2> <ul><li>브라우저와 서버 사이의 미들웨어 역할을 하는 스크립트 파일</li> <li>PWA에서 가장 중요한 역할을 하고, Offline Experience과 Mobile&amp;Web Push의 기반기술</li></ul> <h2 id="자바스크립트와의-차이점"><a href="#자바스크립트와의-차이점" aria-hidden="true" class="header-anchor">#</a> 자바스크립트와의  차이점</h2> <p><code>chrome://serviceworker-internals/</code>
브라우저에서 돌아가고 있는 서비스워커를 확인할 수 있다.
여기서 inspect 버튼을 클릭하고 콘솔창에<code>this</code>를 입력해보자.
일반 브라우저에서 <code>this</code>는 windows를 가리키지만,
서비스워커에서의 <code>this</code>는 service worker를 가리킨다.</p> <h2 id="특징"><a href="#특징" aria-hidden="true" class="header-anchor">#</a> 특징</h2> <ol><li><strong>브라우저의 백그라운드에서 실행</strong>되며 웹페이지와 별개의 라이프 싸이클을 가짐
<ul><li>Javascript UI 쓰레드랑 별도로 동작하는 또다른 쓰레드</li></ul></li> <li><strong>네트워크 요청을 가로챌 수 있어</strong> 해당 자원에 대한 캐쉬 제공 또는 서버에 자원 요청
<ul><li>프로그래밍 가능한 네트워크 <a href="https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9D%EC%8B%9C_%EC%84%9C%EB%B2%84" target="_blank" rel="noopener noreferrer">프록시<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><strong>브라우저 종속적인 생명주기로 백그라운드 동기화 기능 제공</strong> <ul><li>Push 알람의 진입점을 제공</li></ul></li> <li>Web&amp;Mobile Push 수신이 가능하도록 Notification 제공</li> <li>navigator.serviceworker 로 접근</li> <li>기존 Javascript 와의 <strong>별개의 자체 스코프</strong>를 가짐
<ul><li>크롬 개발자 도구의 Console 과의 별개의 서비스워커 전용 Console 존재</li></ul></li> <li>Dom 에 직접적으로 접근이 불가능 - <a href="https://developer.mozilla.org/ko/docs/Web/API/Web_Workers_API/basic_usage" target="_blank" rel="noopener noreferrer">postMessage()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 이용</li> <li>사용하지 않을 때 <strong>자체적으로 종료, 필요시에 다시 동작</strong>(event-driven 방식)</li></ol> <h2 id="배경"><a href="#배경" aria-hidden="true" class="header-anchor">#</a> 배경</h2> <p>기존에 이미 존재하던 기술들을 <strong>보완 -&gt; 그리고 진화</strong></p> <h2 id="라이프-싸이클"><a href="#라이프-싸이클" aria-hidden="true" class="header-anchor">#</a> 라이프 싸이클</h2> <ul><li><strong>서비스워커는 웹 페이지와 별개의 생명주기</strong></li> <li>서비스워커 등록 &amp; 설치 &amp; 활성화 과정을 잠깐 보면
<ol><li><strong>웹페이지에서</strong> 서비스워커 스크립트 <strong>호출</strong></li> <li>브라우저 <strong>백그라운드</strong> 에서 서비스 워커 <strong>설치</strong></li> <li><strong>설치과정</strong>에서 정적 자원 <strong>캐싱</strong>(Cache 실패시 Install 실패)</li> <li><strong>설치 후 활성화</strong>. 네트워크 요청에 대한 가로채기 가능</li></ol></li> <li>사용하지 않을 때는 휴지 상태. 필요시에만 해당 기능 수행</li> <li>메모리 상태에 따라 자체적으로 종료하는 영리함</li></ul> <h2 id="등록"><a href="#등록" aria-hidden="true" class="header-anchor">#</a> 등록</h2> <ul><li>웹브라우저에 등록</li> <li>브라우저에 존재 유무를 확인 후 <code>register()</code>사용</li> <li>index.html 같은 레벨에 sw.js 파일(서비스 워커 스크립트 파일)을 만들고 index.html 안에 아래의 코드를 입력한다.</li> <li>서비스워커의 위치는 주 도메인과 같은 위치에 있어야 합니다.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>if ('serviceWorker'  in  navigator) {
	navigator.serviceWorker.register('sw.js')
	.then(function (reg) {
		console.log('service worker 등록완료', reg);
	})
	.catch(function (err) {
		console.log('service worker 등록실패', err);
	});
}
</code></pre></div><p><a href="https://developers.google.com/web/fundamentals/primers/promises" target="_blank" rel="noopener noreferrer">then? catch? - Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="설치"><a href="#설치" aria-hidden="true" class="header-anchor">#</a> 설치</h2> <ul><li>캐시를 설치</li> <li><code>register()</code>에서 등록한 스크립트 파일(sw.js)에서 <code>install()</code>호출</li> <li>CACHE_NAME : 캐쉬를 담을 파일명 정의</li> <li>filesToCache : 캐쉬할 웹 자원들 정의</li> <li><code>waitUntil()</code> : 안의 로직이 수행될 때 까지 대기</li></ul> <div class="language- extra-class"><pre class="language-text"><code>// 캐싱 스토리지에 저장될 파일 이름
var  CACHE_NAME  =  'pwa-offline-v1';
// 캐싱할 파일 목록
var  filesToCache  = [
	'/',
	'/css/app.css'
];
// 서비스 워커 설치 (웹 자원 캐싱)
self.addEventListener('install', function(event) {
	//캐쉬 등록 또는 기타 로직 수행
	event.waitUntil(
		caches.open(CACHE_NAME)
		.then(function(cache) {
			// 위에 지정한 캐쉬 목록을 'pwa-offline-v1' 캐쉬에 추가
			return  cache.addAll(filesToCache);
		})
		.catch(function(error){
			return  console.log(error);
		})
	);
});
</code></pre></div><p>-주의 : 캐쉬할 파일 중 한개라도 실패하면 전체 실패. 이를 해결하기 위해 sw-toolbox 사용 가능</p> <h2 id="네트워크-요청-응답"><a href="#네트워크-요청-응답" aria-hidden="true" class="header-anchor">#</a> 네트워크 요청 응답</h2> <ul><li>서비스워커 설치 후 캐쉬된 자원에 대한 네트워크 요청이 있을 때는 캐쉬로 돌려준다.</li> <li><code>responWith()</code> : 네트워크 요청 가로채기 및 캐쉬 응답</li> <li><code>match()</code>: 해당 request에 상응하는 캐쉬가 있으면 찾아서 돌려주고 아니면 fetch()로 자원획득</li> <li>개발자도구 Network 패널의 offline 체크 후 캐쉬응답 확인</li></ul> <div class="language- extra-class"><pre class="language-text"><code>self.addEventListener('fetch', function(event){
	event.respondWith(
		caches.match(event.request)
		.then(function(response){
			return  response  ||  fetch(event.request);
		})
		.catch(function(error){
			return  console.log(error);
		})
	);
});
</code></pre></div><h2 id="활성화-및-업데이트"><a href="#활성화-및-업데이트" aria-hidden="true" class="header-anchor">#</a> 활성화 및 업데이트</h2> <ul><li>새로운 서비스워커가 설치되면 활성화 단계로 넘어온다.</li> <li>이전에 사용하던 서비스워커와 이전 캐쉬는 모두 삭제하는 작업진헹</li></ul> <div class="language- extra-class"><pre class="language-text"><code>self.addEventListener('activate', function(event) {
	var  cacheWhitelist  = ['v2'];
	event.waitUntil(
		caches.keys()
		.then(function(keyList) {
			return  Promise.all(
				keyList.map(function(key) {
					if (cacheWhitelist.indexOf(key) ===  -1) {
						return  caches.delete(key);
					}
				})
			);
		})
		.catch(function(error){
			return  console.log(error);
		})
	);
});
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pwa/manifest.html" class="prev">
          Web App Manifest
        </a></span> <span class="next"><a href="/pwa/library.html">
          PWA 보조 라이브러리
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.0bfa8fde.js" defer></script><script src="/assets/js/25.3513309d.js" defer></script>
  </body>
</html>
